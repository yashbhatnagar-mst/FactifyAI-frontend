
{% load static %}

<link rel="stylesheet" href="{%static 'css/navbar.css' %}"/>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="{% static 'css/navbar.css' %}"/>
<nav class="bg-[color:var(--background-color,#ffffff)] shadow-sm sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-[80px]">

      <!-- Logo -->
      <div class="flex-shrink-0">
     <a href="{% url 'home' %}">
    <!-- Light Mode Logo -->
    <img id="logo-light" class="h-23 w-[180px] mt-4 block dark:hidden" src="{% static 'images/black.png' %}" alt="Logo Light" />
    
    <!-- Dark Mode Logo -->
    <img id="logo-dark" class="h-23 w-[180px] mt-4 hidden dark:block" src="{% static 'images/white.png' %}" alt="Logo Dark" />
  </a>
</div>

      <!-- Center Nav Links -->
      <div class="hidden md:flex space-x-10 mx-auto">
        <a href="{% url 'output' %}" class="nav-link {% if request.path == '/output/' %}active{% endif %} text-[var(--text-color)] font-medium">Verify</a>
        <a href="{% url 'about' %}" class="nav-link {% if request.path == '/about/' %}active{% endif %} text-[var(--text-color)] font-medium">About</a>
        <a href="{% url 'contact' %}" class="nav-link {% if request.path == '/contact/' %}active{% endif %} text-[var(--text-color)] font-medium">Contact</a>
        <a href="{% url 'trending' %}" class="nav-link {% if request.path == '/trending/' %}active{% endif %} text-[var(--text-color)] font-medium">Trending</a>
      </div>

      <!-- Right Side -->
      
      <div class="flex items-center space-x-6">

        <button onclick="toggleTheme()" class="text-[var(--text-color)]">
           <i class="fas fa-moon"></i> 
          
        </button>

         {% if user_authenticated %} 
         
          <!-- Profile Dropdown -->
          <div class="relative inline-block text-left">
            <button onclick="toggleDropdown()" class="flex items-center focus:outline-none">
            
            <div class="w-10 h-10 rounded-full  flex items-center justify-center text-white font-bold text-lg">

                 <img src="{% static 'images/user.png' %}"  alt="user pic"
                 style="height:30px"/>                          
              </div>
              
              <svg class="w-4 h-4 ml-1 text-[var(--text-color)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg> 
            </button>

            <!-- Dropdown Menu -->
            <div id="profilemodal" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50">

              <button onclick="openProfileModal()" class="w-full text-left block px-4 py-2 text-gray-700 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                
              <i class="fa-solid fa-user"></i> Profile
              </button>

              <button onclick="openModal('settingsModal')" class="w-full text-left block px-4 py-2 text-gray-700 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
              <i class="fa-solid fa-gear"></i> Settings</button>
              
              <a href="{% url 'logout' %}" class="block px-4 py-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-700 dark:text-red-400">
              <i class="fa-solid fa-right-from-bracket"></i> Sign Out</a>
            </div>
          </div>

        {% else %}
        <a href="{% url 'signup' %}" class="hidden md:inline-block bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">Signup</a>
        {% endif %}

        <!-- Dark Mode Toggle -->
        
      </div>
    </div>
  </div>

  <script>
  function toggleDropdown() {
    const menu = document.getElementById('profilemodal');
    menu.classList.toggle('hidden');
  }

  // Close dropdown when clicking outside
   window.addEventListener('click', function (e) {
    const dropdown = document.getElementById('profilemodal');
    const button = dropdown?.previousElementSibling;
    if (dropdown && !dropdown.contains(e.target) && !button.contains(e.target)) {
      dropdown.classList.add('hidden');
    }
  });

  function openModal(modalId) {
    document.getElementById(modalId).classList.remove('hidden');
    document.body.classList.add('overflow-hidden');
  }

  function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
    document.body.classList.remove('overflow-hidden');
  }

  window.onclick = function (e) {
    document.querySelectorAll(".modal").forEach(modal => {
      if (!modal.classList.contains('hidden') && e.target === modal) {
        closeModal(modal.id);
      }
    });
  };
</script> 


<!-- SETTINGS MODAL -->
<div id="settingsModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 backdrop-blur-sm hidden">
  
  <div class="bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-md relative">
     <button onclick="closeModal('settingsModal')" class="absolute top-3 right-3 text-gray-600 dark:text-gray-300 hover:text-red-500 text-2xl leading-none">
      &times;
    </button>
    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">Settings</h2>   
  
   
   {% comment %} {% if messages %}
  {% for message in messages %}
    <div class="p-3 rounded text-white
         {% if message.tags == 'success' %} bg-green-500
         {% elif message.tags == 'warning' %} bg-yellow-500
         {% elif message.tags == 'error' %} bg-red-500
         {% else %} bg-gray-500 {% endif %}">
      {{ message }}
    </div>
  {% endfor %}
{% endif %} {% endcomment %}

    <!-- Settings Form -->
    <form method="POST" action="">
      {% csrf_token %}

      <form method="POST" action="">
  {% csrf_token %}

  <!-- Language -->
  <label class="block mb-2 font-medium text-black dark:text-white">Language</label>
  <select name="language" class="w-full mb-4 px-4 py-2 border rounded text-black">
    <option value="en" {% if language == 'en' %}selected{% endif %}>English</option>
    <option value="hi" {% if language == 'hi' %}selected{% endif %}>Hindi</option>
  </select>

  <!-- Privacy Mode -->
  <div class="flex items-center mb-6">
    <input type="checkbox" name="privacy" id="privacy" class="mr-2">
    <label for="privacy" class="text-black dark:text-white">Enable Privacy Mode</label>
  </div>

  <button type="submit" class="w-full mb-6 bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700 dark:text-white">
    Save Changes
  </button>
</form>

<!-- Change Password -->
<a href="{% url 'update_pass' %}" class=" text-center block w-full text-left mb-4 px-4 py-2 text-black border border-indigo-500 rounded hover:bg-indigo-50 dark:text-white">
  Change Password
</a>

<!-- Delete Account -->
<form method="POST" action="/delete_account/" onsubmit="return confirm('Are you sure you want to delete your account?');">
  {% csrf_token %}
  <button type="submit" class="w-full px-4 py-2 text-red-500 border border-red-500 rounded  hover:bg-red-500 hover:text-white">
    Delete Account
  </button>
</form>

    <!-- Back -->
    
  </div> 
</div>



<!-- Profile Modal -->
<div id="profileModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 backdrop-blur-sm hidden">
  <div class="bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-md relative">
    <button onclick="closeModal('profileModal')" class="absolute top-3 right-3 text-gray-600 dark:text-gray-300 hover:text-red-500 text-2xl leading-none">
      &times;
    </button>
    <h2 class="text-2xl font-semibold text-gray-800 dark:text-white mb-4 text-center">
      <i class="fa-solid fa-user"></i> Profile
    </h2>
    <div class="space-y-4">
      <p class="text-gray-700 dark:text-gray-300">
        <strong>User name:</strong> <span id="userName" class="first">Loading...</span>
      </p>
      <p class="text-gray-700 dark:text-gray-300">
        <strong>Email:</strong> <span id="userEmail">Loading...</span>
      </p>
    </div>
  </div>
</div>
</nav>

<script>
function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
  return null;
}

async function openProfileModal() {
  const token = getCookie("clarifyai_token");
  console.log("clarifyai_token:", token);

  if (!token) {
    alert("No token found. Please log in.");
    return;
  }

  try {
    const response = await fetch("http://127.0.0.1:8000/api/auth/profile/me", {
      headers: {
        "Authorization": `Bearer ${token}`
      }
    });

    if (!response.ok) {
      throw new Error("Profile fetch failed with status: " + response.status);
    }

    const data = await response.json();
    
    

    const nameElem = document.getElementById("userName");
    const emailElem = document.getElementById("userEmail");
    const modalElem = document.getElementById("profileModal");

    if (!nameElem || !emailElem || !modalElem) {
      console.error("Missing DOM elements.");
      return;
    }

    const fullName = data.data.username || `${data.first_name || ""} ${data.last_name || ""}`.trim() || "N/A";
    const email = data.data.email || "N/A";

    nameElem.textContent = fullName;
    emailElem.textContent = email;
    modalElem.classList.remove("hidden");

  } catch (error) {
    console.error("Failed to load profile:", error);
    alert("Unable to load profile. Are you logged in?");
  }
}

function closeModal(id) {
  const modal = document.getElementById(id);
  if (modal) modal.classList.add("hidden");
}
</script>




